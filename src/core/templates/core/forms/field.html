{#  src/core/templates/core/forms/field.html #}
{% load form_extras %}

{# Props:
  field (required)
  label (optional)
  autocomplete (optional)
  placeholder (optional)
  type (optional)
#}

{% with
  base_input_classes='block w-full h-10 rounded-md border border-border dark:border-white/30 bg-background text-foreground placeholder:text-foreground/60 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:border-ring dark:focus-visible:border-white/80 dark:focus-visible:ring-white/80 ring-offset-background disabled:opacity-50 disabled:cursor-not-allowed'
  id=field.id_for_label
  help_id=id|add:'-help'
  errors_id=id|add:'-errors'
  aria_invalid=field.errors|yesno:"true,false"
  type_val=type|default_if_none:''
  placeholder_val=placeholder|default_if_none:''
  autocomplete_val=autocomplete|default_if_none:''
%}
  <div class="space-y-1.5">
    {% if field.label %}
      <label for="{{ id }}" class="text-sm font-medium text-foreground">
        {{ label|default:field.label }}
      </label>
    {% endif %}

    {# Build attrs string (semicolon-separated) in safe, incremental steps #}
    {% with attrs='class:'|add:base_input_classes %}
    {% with attrs=attrs|add:'; id:'|add:id %}
    {% with attrs=attrs|add:'; aria-invalid:'|add:aria_invalid %}

      {# Conditionally add aria-describedby when we actually have something to reference #}
      {% if field.help_text and field.errors %}
        {% with descval=help_id|add:' '|add:errors_id %}
          {% with attrs=attrs|add:'; aria-describedby:'|add:descval %}{% endwith %}
        {% endwith %}
      {% elif field.help_text %}
        {% with attrs=attrs|add:'; aria-describedby:'|add:help_id %}{% endwith %}
      {% elif field.errors %}
        {% with attrs=attrs|add:'; aria-describedby:'|add:errors_id %}{% endwith %}
      {% endif %}

    {% with attrs=attrs|add:'; type:'|add:type_val %}
    {% with attrs=attrs|add:'; placeholder:'|add:placeholder_val %}
    {% with attrs=attrs|add:'; autocomplete:'|add:autocomplete_val %}
      {{ field|add_attrs:attrs }}
    {% endwith %}{% endwith %}{% endwith %}{% endwith %}{% endwith %}{% endwith %}

    {% if field.help_text %}
      <p id="{{ help_id }}" class="text-xs text-foreground/70">
        {{ field.help_text|safe }}
      </p>
    {% endif %}

    {% if field.errors %}
      <ul id="{{ errors_id }}" class="space-y-0.5 mt-1 list-none pl-0">
        {% for err in field.errors %}
          <li class="text-sm text-red-600 dark:text-red-400">{{ err }}</li>
        {% endfor %}
      </ul>
    {% endif %}
  </div>
{% endwith %}
