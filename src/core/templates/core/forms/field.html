{#  src/core/templates/core/forms/field.html #}
{% load form_extras %}

{# Props:
  field (required)
  label (optional)
  autocomplete (optional)
  placeholder (optional)
  type (optional)
#}

{# Base classes kept on one line to avoid parser issues #}
{% with
  base_input_classes='block w-full h-10 rounded-md border border-border dark:border-white/30 bg-background text-foreground placeholder:text-foreground/60 px-3 py-2 text-sm shadow-sm focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:border-ring dark:focus-visible:border-white/80 dark:focus-visible:ring-white/80 ring-offset-background disabled:opacity-50 disabled:cursor-not-allowed'
  invalid_classes='border-red-500 dark:border-red-400'
%}

  <div class="space-y-1.5">
    {% if field.label %}
      <label for="{{ field.id_for_label }}" class="text-sm font-medium text-foreground">
        {{ label|default:field.label }}
      </label>
    {% endif %}

    {# Build the attrs string progressively for add_attrs #}
    {% with attrs='class:'|add:base_input_classes %}

      {# If invalid, add the red border + aria-invalid #}
      {% if field.errors %}
        {% with attrs=attrs|add:' '|add:invalid_classes %}{% endwith %}
        {% with attrs=attrs|add:'; aria-invalid:true' %}{% endwith %}
      {% endif %}

      {% if type %}
        {% with attrs=attrs|add:'; type:'|add:type %}{% endwith %}
      {% endif %}
      {% if placeholder %}
        {% with attrs=attrs|add:'; placeholder:'|add:placeholder %}{% endwith %}
      {% endif %}
      {% if autocomplete %}
        {% with attrs=attrs|add:'; autocomplete:'|add:autocomplete %}{% endwith %}
      {% endif %}

      {{ field|add_attrs:attrs }}
    {% endwith %}

    {% if field.help_text %}
      <p class="text-xs text-foreground/70">{{ field.help_text|safe }}</p>
    {% endif %}

    {% if field.errors %}
      <ul class="space-y-0.5 mt-1 list-none pl-0">
        {% for err in field.errors %}
          <li class="text-sm text-red-600 dark:text-red-400">{{ err }}</li>
        {% endfor %}
      </ul>
    {% endif %}
  </div>
{% endwith %}
